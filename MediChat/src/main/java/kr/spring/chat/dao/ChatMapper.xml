<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.spring.chat.dao.ChatMapper">
	<insert id="createChat" parameterType="reservationVO">
		INSERT INTO chat(
			chat_num,
			mem_num,
			doc_num,
			reg_date,
			chat_status)
		VALUES(
			chat_seq.nextval,
			mem_num=#{mem_num},
			doc_num=#{doc_num},
			SYSDATE,
			0);
	</insert>
	
	<select id="selectChatListForMem" parameterType="long" resultType="chatVO">
		SELECT c.*,m.mem_name,r.res_date,r.res_time FROM chat c JOIN member m ON (c.doc_num=m.mem_num) JOIN (SELECT r.* FROM reservation r WHERE res_type=0) r ON (c.mem_num=r.mem_num) WHERE c.mem_num=#{mem_num};
	</select>
	
	<select id="selectChatListForDoc" parameterType="long" resultType="chatVO">
		SELECT c.*,m.mem_name,r.res_date,r.res_time
			FROM chat c
			JOIN member m ON (c.mem_num=m.mem_num)
			JOIN (SELECT r.* FROM reservation r WHERE res_type=0) r ON (c.mem_num=r.mem_num)
			WHERE c.mem_num=#{mem_num};
	</select>
	
</mapper>